<sidebar>

    <!-- Job Code -->
    <table id="jobcode">
        <tr>
            <td class="q"></td>
            <td class="jobcodedesc">queued</td>
        </tr>
        <tr>
            <td class="r"></td>
            <td class="jobcodedesc">running</td>
        </tr>
        <tr>
            <td class="d"></td>
            <td class="jobcodedesc">done</td>
        </tr>
        <tr>
            <td class="e">
            </td>
            <td class="jobcodedesc tooltip">error</td>
        </tr>
    </table>


    <div class="sep">
        Recent jobs:
    </div>

    <!--
    Show results of job:
    </div>
    <div class="section">
        <form action="/common/check" method="post">

            <input id="jobid" name="jobid" style="width: 100%;" type="text" value="" />
            <input class="checkbutton" name="showres" type="submit" value="Show results" style="width: 100%;" />
        </form>
    </div>

    <div style="background-color: #7CA6A6; color: #FFFFFF; font-size: 12px; font-weight: bold; padding: 1px 2px 2px 2px; margin-bottom: 2px; margin-top: 15px;">

  -->

        <table id="jobtable" class="tablesorter">
            <tbody id="rows">
                <tr>
                </tr>
            </tbody>
        </table>


        <!--
        <div class="section">
            <input type="hidden" id="clear_checkboxes" value="1">
            <a href="#" onclick="selectjobs();">Select all</a>&nbsp;&nbsp;&nbsp;<a href="#" onclick="deselectjobs();">Deselect all</a>
            <input class="stopbutton" name="clearjobs" type="submit" style="float: none; width: 100%; margin-top: 5px;" value="Clear sel. Jobs" style="width: 100%;" />
            <br/>
            <input class="stopbutton" name="removejobs" type="submit" style="float: none; width: 100%; margin-top: 5px;" value="Delete sel. Jobs" style="width: 100%;" onClick="setAction('clearrecentjobs', '/common/removeJobs');" />
        </div>
        -->
<!--

    <div class="section">@upload()</div>

        <!--
    <script type="text/javascript">

    jQuery("#jobtable").tablesorter();

    </script>-->

</sidebar>



<!-- The View-Model Definition for the JobWidget in the Sidebar -->
<script type="text/javascript">
var a = {};
a[0] = 's'
a[1] = 'p';
a[2] = 'q';
a[3] = 'r';
a[4] = 'e';
a[5] = 'd';

todo = {};
//this application only has one module: todo
//for simplicity, we use this module to namespace the model classes

//the Todo class has two properties
todo.Todo = function(data) {
    this.description = m.prop(data.description);
    this.state = m.prop(data.state);
};

//the TodoList class is a list of Todo's
todo.TodoList = Array;

//the view-model tracks a running list of todos,
//stores a description for new todos before they are created
//and takes care of the logic surrounding when adding is permitted
//and clearing the input after adding a todo to the list
todo.vm = (function() {
    var vm = {};
    vm.init = function() {
        //a running list of todos
        vm.list = new todo.TodoList();


        vm.onclick = function(event){

            var jobID = event();
            var route = jsRoutes.controllers.User.result(jobID);

            $.ajax({
                url: route.url,
                type: "POST"
            }).done(function(data) {

                $("#content").empty();
                $("#content").append(data);
            });

            // Use HTML5 Push state to change the state to result view without reloading
            window.history.pushState("string", "", "/results/" + jobID);
        };

        //adds a todo to the list, and clears the description field for user convenience
        vm.update = function(desc, state) {

            for (var i = 0; i < vm.list.length; i++) {

                var job = vm.list[i];

                if(job.description() == desc) {

                    vm.list[i] = new todo.Todo({description: desc,
                                               state: state});
                    return;
                }
            }
            vm.list.push(new todo.Todo({description: desc,
                                        state: state}));
        };
    };
    return vm
}());

//the controller defines what part of the model is relevant for the current page
//in our case, there's only one view-model that handles everything
todo.controller = function() {
    todo.vm.init()
};

//here's the view
todo.view = function() {
    return [
        [todo.vm.list.map(function(task, index) {
            return m("tr[class=job]", {onclick: todo.vm.onclick.bind(task, task.description)},
                           [m("td[class=" + a[task.state()] + ']'),
                            m("td", task.description())]);
        })]]
};
m.mount(document.getElementById("rows"), {controller: todo.controller, view: todo.view});


</script>



    <!--
    var vm = todo.vm

m("button", {onclick: vm.add.bind(vm, vm.description)}, "Add")


onclick: function(e) {
    todo.vm.add(todo.vm.description)
}
   -->


